<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Scam Sniffer</title>
  <style>
    body { font-family: Arial; margin:2rem; }
    textarea { width:100%; height:150px; }
    .result { margin-top:20px; padding:10px; border:1px solid #ccc; }
  </style>
</head>
<body>
  <h1>Scam Sniffer</h1>
  <p id="userCount">Active users: 0</p>
  
  <textarea id="text" placeholder="Paste your message here..."></textarea>
  <div id="result" class="result" style="display:none;"></div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    const socket = io("http://localhost:5000");

    const userCountDiv = document.getElementById("userCount");
    const textarea = document.getElementById("text");
    const resultDiv = document.getElementById("result");

    // Show active users
    socket.on("userCount", count => {
      userCountDiv.textContent = `Active users: ${count}`;
    });

    // Real-time analysis as user types
    let timeout;
    textarea.addEventListener("input", () => {
      clearTimeout(timeout); // debounce
      timeout = setTimeout(() => {
        const text = textarea.value;
        if (text.trim() === "") {
          resultDiv.style.display = "none";
          return;
        }
        socket.emit("analyzeText", text);
      }, 300); // wait 300ms after last keystroke
    });

    // Receive analysis results
    socket.on("analysisResult", (data) => {
      resultDiv.style.display = "block";
      resultDiv.innerHTML = `
        <p><strong>Score:</strong> ${data.score}/100</p>
        <p><strong>Risk Level:</strong> ${data.level}</p>
        <h3>Indicators:</h3>
        <ul>${data.indicators.map(i => `<li>${i.description}</li>`).join('')}</ul>
      `;
    });

    // Optional: log all analyses (for admin view)
    socket.on("newAnalysis", data => {
      console.log("New analysis broadcast:", data);
    });
  </script>
</body>
</html>
